---
/**
 * 2026 Reading Competition Landing Page
 *
 * This page displays the 2026 reading competition with:
 * - Hero section with animated background and stats
 * - Podium for top 3 readers (gold, silver, bronze)
 * - Leaderboard for remaining participants
 * - CTA to add books
 *
 * Design: Purple/pink gradient theme with blob animations
 */

import Layout2025 from '../layouts/Layout2025.astro';
import { getCollection } from 'astro:content';

// Fetch all competitors and books for 2026 from Astro content collections
const concorrenti = await getCollection('concorrenti26'); // Array of competitor objects
const libros = await getCollection('libros26'); // Array of book objects

// Sort competitors by points (highest first) for leaderboard ranking
const sortedConcorrenti = concorrenti.sort(
  (a, b) => b.data.punti - a.data.punti // Sort descending: b.points - a.points
);

// Calculate total pages read by summing all book pages
// Uses reduce to accumulate, defaulting to 0 if pages field is missing
const totalPages = libros.reduce(
  (sum, libro) => sum + (libro.data.pages || 0),
  0
);

// Debug logs to verify data is loading correctly
console.log('Libros:', libros);
console.log('Concorrenti:', concorrenti);
console.log('Sorted:', sortedConcorrenti);

// Extract top 3 competitors for podium display
// These might be undefined if there are fewer than 3 competitors
const firstPlace = sortedConcorrenti[0]; // Gold medal - 1st place
const secondPlace = sortedConcorrenti[1]; // Silver medal - 2nd place
const thirdPlace = sortedConcorrenti[2]; // Bronze medal - 3rd place

// Get remaining competitors (4th place and below) for regular leaderboard
const restOfLeaderboard = sortedConcorrenti.slice(3);
---

<!--
  Main layout wrapper using Layout2025
  Title: "2026 Lehiaketa" = "2026 Competition"
-->
<Layout2025 title='2026 Lehiaketa'>
  <!-- Full-height container with dark gradient background (gray â†’ purple â†’ black) -->
  <div
    class='min-h-screen bg-gradient-to-br from-gray-900 via-purple-900 to-black text-white relative overflow-hidden'>
    <!-- ANIMATED BACKGROUND BLOBS -->
    <!-- Three large, blurred circles that move slowly to create dynamic background effect -->

    <!-- Purple blob (top-left corner) -->
    <div
      class='absolute top-0 left-0 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob'>
    </div>

    <!-- Pink blob (top-right corner, animation delayed by 2 seconds) -->
    <div
      class='absolute top-0 right-0 w-96 h-96 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000'>
    </div>

    <!-- Blue blob (bottom center, animation delayed by 4 seconds) -->
    <div
      class='absolute bottom-0 left-1/2 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000'>
    </div>

    <!-- MAIN CONTENT CONTAINER -->
    <!-- z-10 keeps content above the animated blobs -->
    <div class='relative z-10 container mx-auto px-4 py-16'>
      <!-- HERO SECTION -->
      <div class='text-center mb-16 space-y-6'>
        <!-- Large animated title: "2026" with gradient text effect -->
        <h1
          class='text-6xl md:text-8xl font-black bg-gradient-to-r from-purple-400 via-pink-400 to-blue-400 bg-clip-text text-transparent animate-gradient'>
          2026
        </h1>

        <!-- Subtitle: "Irakurketa Lehiaketa Berria" = "New Reading Competition" -->
        <p class='text-xl md:text-2xl text-gray-300 font-light'>
          Irakurketa Lehiaketa Berria
        </p>

        <!-- QUICK STATS CARDS -->
        <!-- Three cards showing: Books, Pages, Competitors -->
        <div
          class='grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto mt-12'>
          <!-- BOOKS STAT CARD -->
          <!-- "Liburuak" = "Books" -->
          <div
            class='bg-white/10 backdrop-blur-md rounded-2xl p-6 hover:bg-white/20 transition-all duration-300 hover:scale-105'>
            <div class='text-4xl font-bold text-purple-400'>
              {libros.length}
            </div>
            <div class='text-gray-300 mt-2'>Liburuak</div>
          </div>

          <!-- PAGES STAT CARD -->
          <!-- "Orrialdeak" = "Pages" -->
          <div
            class='bg-white/10 backdrop-blur-md rounded-2xl p-6 hover:bg-white/20 transition-all duration-300 hover:scale-105'>
            <div class='text-4xl font-bold text-pink-400'>
              {totalPages.toLocaleString()}
            </div>
            <div class='text-gray-300 mt-2'>Orrialdeak</div>
          </div>

          <!-- COMPETITORS STAT CARD -->
          <!-- "Lehiakideak" = "Competitors" -->
          <div
            class='bg-white/10 backdrop-blur-md rounded-2xl p-6 hover:bg-white/20 transition-all duration-300 hover:scale-105'>
            <div class='text-4xl font-bold text-blue-400'>
              {concorrenti.length}
            </div>
            <div class='text-gray-300 mt-2'>Lehiakideak</div>
          </div>
        </div>

        <!-- CALL-TO-ACTION BUTTONS -->
        <div
          class='flex flex-col sm:flex-row gap-4 justify-center items-center mt-12'>

          <!-- Primary CTA: "Ikusi Liburuak" = "View Books" -->
          <a
            href='/liburuak'
            class='px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full font-bold hover:shadow-2xl hover:shadow-purple-500/50 transition-all duration-300 hover:scale-105'>
            Ikusi Liburuak
          </a>

          <!-- Secondary CTA: "Lehiakideak" = "Competitors" -->
          <a
            href='/lehiakideak'
            class='px-8 py-4 bg-white/10 backdrop-blur-md rounded-full font-bold border-2 border-white/20 hover:bg-white/20 transition-all duration-300 hover:scale-105'>
            Lehiakideak
          </a>
        </div>

        <!-- SCROLL INDICATOR -->
        <!-- Animated down arrow suggesting more content below -->
        <div class='mt-16 animate-bounce'>
          <svg
            class='w-6 h-6 mx-auto text-purple-400'
            fill='none'
            stroke='currentColor'
            viewBox='0 0 24 24'>
            <path
              stroke-linecap='round'
              stroke-linejoin='round'
              stroke-width='2'
              d='M19 14l-7 7m0 0l-7-7m7 7V3'></path>
          </svg>
        </div>
      </div>

      <!-- PODIUM SECTION -->
      <!-- Only displays if there are at least 3 competitors -->
      {
        sortedConcorrenti.length >= 3 && (
          <div class='mb-24'>
            <!-- Section title: "Top 3 Irakurleak" = "Top 3 Readers" -->
            <h2 class='text-4xl font-bold text-center mb-12 bg-gradient-to-r from-yellow-400 via-yellow-300 to-yellow-400 bg-clip-text text-transparent'>
              Top 3 Irakurleak
            </h2>

            <!-- PODIUM DISPLAY: Card style -->
            <div class='grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto'>
              {/* SECOND PLACE (SILVER) */}
              {secondPlace && (
                <div class='bg-gradient-to-br from-gray-400 to-gray-600 rounded-2xl px-8 py-10 text-center shadow-2xl shadow-gray-500/30 hover:shadow-gray-500/50 transition-all duration-300 flex flex-col items-center relative'>
                  <span class='absolute top-4 left-4 text-3xl'>ðŸ¥ˆ</span>
                  <span class='absolute top-4 right-4 bg-gradient-to-br from-gray-300 to-gray-400 rounded-full px-3 py-1 font-bold text-sm shadow-lg'>2</span>
                  <h3 class='text-xl font-bold mb-2 mt-8'>{secondPlace.data.nome}</h3>
                  <p class='text-3xl font-black text-white'>{secondPlace.data.punti}</p>
                  <p class='text-sm text-gray-200 mt-1'>puntuak</p>
                </div>
              )}

              {/* FIRST PLACE (GOLD) */}
              {firstPlace && (
                <div class='bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-2xl px-10 py-12 text-center shadow-2xl shadow-yellow-500/50 hover:shadow-yellow-500/70 transition-all duration-300 flex flex-col items-center relative'>
                  <span class='absolute top-4 left-4 text-3xl'>ðŸ¥‡</span>
                  <span class='absolute top-4 right-4 bg-gradient-to-br from-yellow-400 to-yellow-600 rounded-full px-3 py-1 font-bold shadow-lg'>1</span>
                  <h3 class='text-2xl font-bold mb-2 mt-8 text-gray-900'>{firstPlace.data.nome}</h3>
                  <p class='text-4xl font-black text-gray-900'>{firstPlace.data.punti}</p>
                  <p class='text-sm text-gray-800 mt-2 font-semibold'>puntuak</p>
                </div>
              )}

              {/* THIRD PLACE (BRONZE) */}
              {thirdPlace && (
                <div class='bg-gradient-to-br from-orange-400 to-orange-700 rounded-2xl px-8 py-10 text-center shadow-2xl shadow-orange-500/30 hover:shadow-orange-500/50 transition-all duration-300 flex flex-col items-center relative'>
                  <span class='absolute top-4 left-4 text-3xl'>ðŸ¥‰</span>
                  <span class='absolute top-4 right-4 bg-gradient-to-br from-orange-400 to-orange-600 rounded-full px-3 py-1 font-bold text-sm shadow-lg'>3</span>
                  <h3 class='text-xl font-bold mb-2 mt-8'>{thirdPlace.data.nome}</h3>
                  <p class='text-3xl font-black text-white'>{thirdPlace.data.punti}</p>
                  <p class='text-sm text-gray-200 mt-1'>puntuak</p>
                </div>
              )}
            </div>
          </div>
        )
      }

      {/* LEADERBOARD SECTION */}
      {/* Displays competitors ranked 4th and below */}
      {/* Only shows if there are competitors beyond the top 3 */}
      {
        restOfLeaderboard.length > 0 && (
          <div class='max-w-3xl mx-auto mb-16'>
            <!-- Section title: "Sailkapena" = "Ranking" or "Leaderboard" -->
            <h2 class='text-3xl font-bold text-center mb-8 text-purple-300'>
              Sailkapena
            </h2>

            <!-- List of competitor cards -->
            <div class='space-y-4'>
              {restOfLeaderboard.map((competitor, index) => (
                <!-- Individual competitor card (glass-morphism style) -->
                <div class='bg-white/5 backdrop-blur-md rounded-2xl p-6 hover:bg-white/10 transition-all duration-300 hover:scale-[1.02] border border-white/10 hover:border-purple-500/50 hover:shadow-xl hover:shadow-purple-500/20'>
                  <div class='flex items-center justify-between'>
                    <!-- Left side: Position badge, avatar, name -->
                    <div class='flex items-center gap-4'>
                      <!-- Position number (4th, 5th, 6th, etc.) -->
                      <!-- index + 4 because this list starts after top 3 -->
                      <div class='w-12 h-12 rounded-full bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center font-bold text-lg shadow-lg'>
                        {index + 4}
                      </div>
                      <!-- Generic avatar icon -->
                      <div class='w-16 h-16 rounded-full bg-gradient-to-br from-gray-600 to-gray-800 flex items-center justify-center text-3xl shadow-lg'>
                        ðŸ‘¤
                      </div>
                      <!-- Competitor name and username -->
                      <div>
                        <h3 class='text-xl font-bold text-white'>
                          {competitor.data.nome}
                        </h3>
                        <p class='text-sm text-gray-400'>
                          @{competitor.data.username}
                        </p>
                      </div>
                    </div>
                    <!-- Right side: Points -->
                    <div class='text-right'>
                      <p class='text-3xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent'>
                        {competitor.data.punti}
                      </p>
                      <p class='text-sm text-gray-400'>puntuak</p>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        )
      }

      {/* CALL-TO-ACTION SECTION */}
      {/* Encourages users to add their books */}
      <div
        class='max-w-2xl mx-auto text-center bg-white/5 backdrop-blur-md rounded-3xl p-12 border border-white/10'>

        <!-- Heading: "Gehitu zure liburua!" = "Add your book!" -->
        <h2
          class='text-3xl font-bold mb-4 bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent'>
          Gehitu zure liburua!
        </h2>

        <!-- Description: "Irakurri duzu liburu bat? Gehitu eta puntuak lortu!" = "Have you read a book? Add it and earn points!" -->
        <p class='text-gray-300 mb-8'>
          Irakurri duzu liburu bat? Gehitu eta puntuak lortu!
        </p>

        <!-- CTA Button: "Liburu berria gehitu" = "Add new book" -->
        <a
          href='/dashboard'
          class='inline-block px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 rounded-full font-bold hover:shadow-2xl hover:shadow-purple-500/50 transition-all duration-300 hover:scale-105'>
          Liburu berria gehitu
        </a>
      </div>
    </div>
  </div>
</Layout2025>

<!-- CUSTOM ANIMATIONS AND STYLES -->
<style>
  /*
   * Blob Animation
   * Creates a flowing movement effect for background blobs
   * Duration: 7 seconds, loops infinitely
   * Movement: Translates and scales in a circular pattern
   */
  @keyframes blob {
    0% {
      transform: translate(0px, 0px) scale(1);
    }
    33% {
      transform: translate(30px, -50px) scale(1.1);
    }
    66% {
      transform: translate(-20px, 20px) scale(0.9);
    }
    100% {
      transform: translate(0px, 0px) scale(1);
    }
  }

  /*
   * Gradient Animation
   * Animates gradient background position for text effects
   * Duration: 3 seconds, loops infinitely
   * Creates a flowing color shift effect
   */
  @keyframes gradient {
    0% {
      background-position: 0% 50%;
    }
    50% {
      background-position: 100% 50%;
    }
    100% {
      background-position: 0% 50%;
    }
  }

  /* Apply blob animation */
  .animate-blob {
    animation: blob 7s infinite;
  }

  /* Delay blob animation start by 2 seconds (for staggered effect) */
  .animation-delay-2000 {
    animation-delay: 2s;
  }

  /* Delay blob animation start by 4 seconds */
  .animation-delay-4000 {
    animation-delay: 4s;
  }

  /* Apply gradient animation to text */
  .animate-gradient {
    background-size: 200% 200%;
    animation: gradient 3s ease infinite;
  }

  /*
   * Custom Scrollbar Styling
   * Purple/pink gradient scrollbar matching the page theme
   */
  ::-webkit-scrollbar {
    width: 10px;
  }

  ::-webkit-scrollbar-track {
    background: rgba(0, 0, 0, 0.3);
  }

  ::-webkit-scrollbar-thumb {
    background: linear-gradient(to bottom, #a855f7, #ec4899); /* Purple to pink */
    border-radius: 5px;
  }

  ::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(to bottom, #9333ea, #db2777); /* Darker on hover */
  }
</style>
